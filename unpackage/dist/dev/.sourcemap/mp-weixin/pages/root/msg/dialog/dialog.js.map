{"version":3,"sources":["uni-app:///main.js","webpack:///D:/Users/Ryan/Documents/HBuilderProjects/team/pages/root/msg/dialog/dialog.vue?f37c","webpack:///D:/Users/Ryan/Documents/HBuilderProjects/team/pages/root/msg/dialog/dialog.vue?418d","webpack:///D:/Users/Ryan/Documents/HBuilderProjects/team/pages/root/msg/dialog/dialog.vue?5010","webpack:///D:/Users/Ryan/Documents/HBuilderProjects/team/pages/root/msg/dialog/dialog.vue?7af3","uni-app:///pages/root/msg/dialog/dialog.vue","webpack:///D:/Users/Ryan/Documents/HBuilderProjects/team/pages/root/msg/dialog/dialog.vue?fbdb"],"names":["createPage","Page","renderjs","component","options","__file","components","uToast","uNavbar","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped"],"mappings":"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","file":"pages/root/msg/dialog/dialog.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/root/msg/dialog/dialog.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./dialog.vue?vue&type=template&id=593f5bad&\"\nvar renderjs\nimport script from \"./dialog.vue?vue&type=script&lang=js&\"\nexport * from \"./dialog.vue?vue&type=script&lang=js&\"\nimport style0 from \"./dialog.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/root/msg/dialog/dialog.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./dialog.vue?vue&type=template&id=593f5bad&\"","var components\ntry {\n  components = {\n    uToast: function() {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-toast/u-toast\" */ \"@/uview-ui/components/u-toast/u-toast.vue\"\n      )\n    },\n    uNavbar: function() {\n      return import(\n        /* webpackChunkName: \"uview-ui/components/u-navbar/u-navbar\" */ \"@/uview-ui/components/u-navbar/u-navbar.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./dialog.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./dialog.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<u-toast ref=\"uToast\" />\r\n\t\t<u-navbar\r\n\t\t\t:is-fixed=\"true\"\r\n\t\t\t:background=\"background\"\r\n\t\t\t:back-text-style=\"color\"\r\n\t\t\tback-text=\" \"\r\n\t\t\ttitle-color=\"#f5f5f5\"\r\n\t\t\tback-icon-color=\"#f5f5f5\">\r\n\t\t\t\t<view class=\"title ellipsis\" \r\n\t\t\t\t\t@click=\"navigate\"\r\n\t\t\t\t\t:style=\"[{width:info.windowWidth - info.width-60+'px'}]\">\r\n\t\t\t\t\t{{targetUserInfo.alias}}\r\n\t\t\t\t</view>\r\n\t\t</u-navbar>\r\n\t\t<view class=\"content\" @touchstart=\"hideDrawer\">\r\n\t\t\t<scroll-view \r\n\t\t\t\t:style=\"[{top:info.statusHeight+48+'px'}]\"\r\n\t\t\t\tclass=\"msg-list\" scroll-y=\"true\" \r\n\t\t\t\t:scroll-with-animation=\"scrollAnimation\" \r\n\t\t\t\t:show-scrollbar=\"false\"\r\n\t\t\t\t:scroll-top=\"scrollTop\" \r\n\t\t\t\t:scroll-into-view=\"scrollToView\" \r\n\t\t\t\t@scrolltoupper=\"loadHistory\" \r\n\t\t\t\tupper-threshold=\"50\">\r\n\t\t\t\t<!-- 加载历史数据waitingUI -->\r\n\t\t\t\t<view class=\"loading\">\r\n\t\t\t\t\t<view class=\"spinner\">\r\n\t\t\t\t\t\t<view class=\"rect1\"></view>\r\n\t\t\t\t\t\t<view class=\"rect2\"></view>\r\n\t\t\t\t\t\t<view class=\"rect3\"></view>\r\n\t\t\t\t\t\t<view class=\"rect4\"></view>\r\n\t\t\t\t\t\t<view class=\"rect5\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"row\" v-for=\"(row,index) in msgList\" :key=\"index\" :id=\"index\">\r\n\t\t\t\t\t<!-- 系统消息 -->\r\n\t\t\t\t\t<block v-if=\"row.type==1\">\r\n\t\t\t\t\t\t<view class=\"system\">\r\n\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.contentType==0\" class=\"text\">\r\n\t\t\t\t\t\t\t\t{{row.content}}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</block>\r\n\t\t\t\t\t<!-- 用户消息 -->\r\n\t\t\t\t\t<block v-if=\"row.type==0\">\r\n\t\t\t\t\t\t<!-- 自己发出的消息 -->\r\n\t\t\t\t\t\t<view class=\"my\" v-if=\"row.senderUserId==app.userInfo.userId\">\r\n\t\t\t\t\t\t\t<!-- 左-消息 -->\r\n\t\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.contentType==0\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"row.content\"></rich-text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 语言消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.contentType==2\" class=\"bubble voice\" @tap=\"playVoice(row.msg)\" :class=\"playMsgid == row.msg.id?'play':''\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"length\">{{row.length}}</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"icon my-voice\"></view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.contentType==1\" class=\"bubble img\" @tap=\"showPic(row.msg)\">\r\n\t\t\t\t\t\t\t\t\t<image :src=\"row.url\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 右-头像 -->\r\n\t\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t\t<image :src=\"app.userInfo_.avatar\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- 别人发出的消息 -->\r\n\t\t\t\t\t\t<view class=\"other\" v-if=\"row.senderUserId==targetUserInfo.userId\">\r\n\t\t\t\t\t\t\t<!-- 顶上 -->\r\n\t\t\t\t\t\t\t<view class=\"other_time\">{{row.sendingTime}}</view>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<view class=\"other_rest\">\r\n\t\t\t\t\t\t\t\t<!-- 左-头像 -->\r\n\t\t\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t\t\t<image :src=\"targetUserInfo.avatar\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 右-用户名称-时间-消息 -->\r\n\t\t\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"username_wrap\">\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"username ellipsis\">\r\n\t\t\t\t\t\t\t\t\t\t\t{{targetUserInfo.alias}}\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t</view> \r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"row.contentType==0\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"row.content\"></rich-text>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<!-- 语音消息 -->\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"row.contentType==2\" class=\"bubble voice\" @tap=\"playVoice(row.msg)\" :class=\"playMsgid == row.msg.id?'play':''\">\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"icon other-voice\"></view>\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"length\">{{row.length}}</view>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t\t<view v-if=\"row.contentType==1\" class=\"bubble img\" @tap=\"showPic(row.msg)\">\r\n\t\t\t\t\t\t\t\t\t\t<image :src=\"row.url\" mode=\"widthFix\"></image>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</block>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 抽屉栏 -->\r\n\t\t<view class=\"popup-layer\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- 表情 --> \r\n\t\t\t<swiper class=\"emoji-swiper\" :class=\"{hidden:hideEmoji}\" indicator-dots=\"true\" duration=\"150\">\r\n\t\t\t\t<swiper-item v-for=\"(page,pid) in emojiList\" :key=\"pid\">\r\n\t\t\t\t\t<view v-for=\"(em,eid) in page\" :key=\"eid\" @tap=\"addEmoji(em)\">\r\n\t\t\t\t\t\t<image mode=\"widthFix\" :src=\"'https://stea.ryanalexander.cn/im/'+em.url\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</swiper-item>\r\n\t\t\t</swiper>\r\n\t\t\t<!-- 更多功能 相册-拍照-红包 -->\r\n\t\t\t<view class=\"more-layer\" :class=\"{hidden:hideMore}\">\r\n\t\t\t\t<view class=\"list\">\r\n\t\t\t\t\t<view class=\"box\" @tap=\"chooseImage\"><view class=\"icon tupian2\"></view></view>\r\n\t\t\t\t\t<view class=\"box\" @tap=\"camera\"><view class=\"icon paizhao\"></view></view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 底部输入栏 -->\r\n\t\t<view class=\"input-box\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- H5下不能录音，输入栏布局改动一下 -->\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<view class=\"voice\">\r\n\t\t\t\t<view class=\"icon\" :class=\"isVoice?'jianpan':'yuyin'\" @tap=\"switchVoice\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<!-- #ifdef H5 -->\r\n\t\t\t<view class=\"more\" @tap=\"showMore\">\r\n\t\t\t\t<view class=\"icon add\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"textbox\">\r\n\t\t\t\t<view class=\"voice-mode\" :class=\"[isVoice?'':'hidden',recording?'recording':'']\" @touchstart=\"voiceBegin\" @touchmove.stop.prevent=\"voiceIng\" @touchend=\"voiceEnd\" @touchcancel=\"voiceCancel\">{{voiceTis}}</view>\r\n\t\t\t\t<view class=\"text-mode\"  :class=\"isVoice?'hidden':''\">\r\n\t\t\t\t\t<view class=\"box\">\r\n\t\t\t\t\t\t<textarea auto-height=\"true\" v-model=\"textMsg\" @focus=\"textareaFocus\"/>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"em\" @tap=\"chooseEmoji\">\r\n\t\t\t\t\t\t<view class=\"icon biaoqing\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<view class=\"more\" @tap=\"showMore\">\r\n\t\t\t\t<view class=\"icon add\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"send\" :class=\"isVoice?'hidden':''\" @tap=\"sendText\">\r\n\t\t\t\t<view class=\"btn\">发送</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 录音UI效果 -->\r\n\t\t<view class=\"record\" :class=\"recording?'':'hidden'\">\r\n\t\t\t<view class=\"ing\" :class=\"willStop?'hidden':''\"><view class=\"icon luyin2\" ></view></view>\r\n\t\t\t<view class=\"cancel\" :class=\"willStop?'':'hidden'\"><view class=\"icon chehui\" ></view></view>\r\n\t\t\t<view class=\"tis\" :class=\"willStop?'change':''\">{{recordTis}}</view>\r\n\t\t</view>\r\n\t\t\r\n\t</view>\r\n</template>\r\n<script>\r\n\timport {getUserInfo} from \"@/api/api.js\";\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttargetUserInfo: -1,\r\n\t\t\t\tapp: {},\r\n\t\t\t\tdurationPullDownRefresh: 400,\r\n\t\t\t\trefresh_status: false,\r\n\t\t\t\t\r\n\t\t\t\tinfo: {},\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tbackground: {\r\n\t\t\t\t\tbackground: 'url(https://stea.ryanalexander.cn/navbar/22.jpg) no-repeat',\r\n\t\t\t\t\tbackgroundSize: '100% 100%'\r\n\t\t\t\t},\r\n\t\t\t\tcolor: {color:'#f5f5f5' },\r\n\t\t\t\t//文字消息\r\n\t\t\t\ttextMsg:'',\r\n\t\t\t\t//消息列表\r\n\t\t\t\tisHistoryLoading:false,\r\n\t\t\t\tscrollAnimation:false,\r\n\t\t\t\tscrollTop:0,\r\n\t\t\t\tscrollToView:'',\r\n\t\t\t\tmsgList:[],\r\n\t\t\t\tmsgImgList:[],\r\n\t\t\t\tmyuid:0,\r\n\t\t\t\t\r\n\t\t\t\t//录音相关参数\r\n\t\t\t\t// #ifndef H5\r\n\t\t\t\t//H5不能录音\r\n\t\t\t\tRECORDER:uni.getRecorderManager(),\r\n\t\t\t\t// #endif\r\n\t\t\t\tisVoice:false,\r\n\t\t\t\tvoiceTis:'按住 说话',\r\n\t\t\t\trecordTis:\"手指上滑 取消发送\",\r\n\t\t\t\trecording:false,\r\n\t\t\t\twillStop:false,\r\n\t\t\t\tinitPoint:{identifier:0,Y:0},\r\n\t\t\t\trecordTimer:null,\r\n\t\t\t\trecordLength:0,\r\n\t\t\t\t\r\n\t\t\t\t//播放语音相关参数\r\n\t\t\t\tAUDIO:uni.createInnerAudioContext(),\r\n\t\t\t\tplayMsgid:null,\r\n\t\t\t\tVoiceTimer:null,\r\n\t\t\t\t// 抽屉参数\r\n\t\t\t\tpopupLayerClass:'',\r\n\t\t\t\t// more参数\r\n\t\t\t\thideMore:true,\r\n\t\t\t\t//表情定义\r\n\t\t\t\thideEmoji:true,\r\n\t\t\t\temojiList:[\r\n\t\t\t\t\t[{\"url\":\"100.gif\",alt:\"[微笑]\"},{\"url\":\"101.gif\",alt:\"[伤心]\"},{\"url\":\"102.gif\",alt:\"[美女]\"},{\"url\":\"103.gif\",alt:\"[发呆]\"},{\"url\":\"104.gif\",alt:\"[墨镜]\"},{\"url\":\"105.gif\",alt:\"[哭]\"},{\"url\":\"106.gif\",alt:\"[羞]\"},{\"url\":\"107.gif\",alt:\"[哑]\"},{\"url\":\"108.gif\",alt:\"[睡]\"},{\"url\":\"109.gif\",alt:\"[哭]\"},{\"url\":\"110.gif\",alt:\"[囧]\"},{\"url\":\"111.gif\",alt:\"[怒]\"},{\"url\":\"112.gif\",alt:\"[调皮]\"},{\"url\":\"113.gif\",alt:\"[笑]\"},{\"url\":\"114.gif\",alt:\"[惊讶]\"},{\"url\":\"115.gif\",alt:\"[难过]\"},{\"url\":\"116.gif\",alt:\"[酷]\"},{\"url\":\"117.gif\",alt:\"[汗]\"},{\"url\":\"118.gif\",alt:\"[抓狂]\"},{\"url\":\"119.gif\",alt:\"[吐]\"},{\"url\":\"120.gif\",alt:\"[笑]\"},{\"url\":\"121.gif\",alt:\"[快乐]\"},{\"url\":\"122.gif\",alt:\"[奇]\"},{\"url\":\"123.gif\",alt:\"[傲]\"}],\r\n\t\t\t\t\t[{\"url\":\"124.gif\",alt:\"[饿]\"},{\"url\":\"125.gif\",alt:\"[累]\"},{\"url\":\"126.gif\",alt:\"[吓]\"},{\"url\":\"127.gif\",alt:\"[汗]\"},{\"url\":\"128.gif\",alt:\"[高兴]\"},{\"url\":\"129.gif\",alt:\"[闲]\"},{\"url\":\"130.gif\",alt:\"[努力]\"},{\"url\":\"131.gif\",alt:\"[骂]\"},{\"url\":\"132.gif\",alt:\"[疑问]\"},{\"url\":\"133.gif\",alt:\"[秘密]\"},{\"url\":\"134.gif\",alt:\"[乱]\"},{\"url\":\"135.gif\",alt:\"[疯]\"},{\"url\":\"136.gif\",alt:\"[哀]\"},{\"url\":\"137.gif\",alt:\"[鬼]\"},{\"url\":\"138.gif\",alt:\"[打击]\"},{\"url\":\"139.gif\",alt:\"[bye]\"},{\"url\":\"140.gif\",alt:\"[汗]\"},{\"url\":\"141.gif\",alt:\"[抠]\"},{\"url\":\"142.gif\",alt:\"[鼓掌]\"},{\"url\":\"143.gif\",alt:\"[糟糕]\"},{\"url\":\"144.gif\",alt:\"[恶搞]\"},{\"url\":\"145.gif\",alt:\"[什么]\"},{\"url\":\"146.gif\",alt:\"[什么]\"},{\"url\":\"147.gif\",alt:\"[累]\"}],\r\n\t\t\t\t\t[{\"url\":\"148.gif\",alt:\"[看]\"},{\"url\":\"149.gif\",alt:\"[难过]\"},{\"url\":\"150.gif\",alt:\"[难过]\"},{\"url\":\"151.gif\",alt:\"[坏]\"},{\"url\":\"152.gif\",alt:\"[亲]\"},{\"url\":\"153.gif\",alt:\"[吓]\"},{\"url\":\"154.gif\",alt:\"[可怜]\"},{\"url\":\"155.gif\",alt:\"[刀]\"},{\"url\":\"156.gif\",alt:\"[水果]\"},{\"url\":\"157.gif\",alt:\"[酒]\"},{\"url\":\"158.gif\",alt:\"[篮球]\"},{\"url\":\"159.gif\",alt:\"[乒乓]\"},{\"url\":\"160.gif\",alt:\"[咖啡]\"},{\"url\":\"161.gif\",alt:\"[美食]\"},{\"url\":\"162.gif\",alt:\"[动物]\"},{\"url\":\"163.gif\",alt:\"[鲜花]\"},{\"url\":\"164.gif\",alt:\"[枯]\"},{\"url\":\"165.gif\",alt:\"[唇]\"},{\"url\":\"166.gif\",alt:\"[爱]\"},{\"url\":\"167.gif\",alt:\"[分手]\"},{\"url\":\"168.gif\",alt:\"[生日]\"},{\"url\":\"169.gif\",alt:\"[电]\"},{\"url\":\"170.gif\",alt:\"[炸弹]\"},{\"url\":\"171.gif\",alt:\"[刀子]\"}],\r\n\t\t\t\t\t[{\"url\":\"172.gif\",alt:\"[足球]\"},{\"url\":\"173.gif\",alt:\"[瓢虫]\"},{\"url\":\"174.gif\",alt:\"[翔]\"},{\"url\":\"175.gif\",alt:\"[月亮]\"},{\"url\":\"176.gif\",alt:\"[太阳]\"},{\"url\":\"177.gif\",alt:\"[礼物]\"},{\"url\":\"178.gif\",alt:\"[抱抱]\"},{\"url\":\"179.gif\",alt:\"[拇指]\"},{\"url\":\"180.gif\",alt:\"[贬低]\"},{\"url\":\"181.gif\",alt:\"[握手]\"},{\"url\":\"182.gif\",alt:\"[剪刀手]\"},{\"url\":\"183.gif\",alt:\"[抱拳]\"},{\"url\":\"184.gif\",alt:\"[勾引]\"},{\"url\":\"185.gif\",alt:\"[拳头]\"},{\"url\":\"186.gif\",alt:\"[小拇指]\"},{\"url\":\"187.gif\",alt:\"[拇指八]\"},{\"url\":\"188.gif\",alt:\"[食指]\"},{\"url\":\"189.gif\",alt:\"[ok]\"},{\"url\":\"190.gif\",alt:\"[情侣]\"},{\"url\":\"191.gif\",alt:\"[爱心]\"},{\"url\":\"192.gif\",alt:\"[蹦哒]\"},{\"url\":\"193.gif\",alt:\"[颤抖]\"},{\"url\":\"194.gif\",alt:\"[怄气]\"},{\"url\":\"195.gif\",alt:\"[跳舞]\"}],\r\n\t\t\t\t\t[{\"url\":\"196.gif\",alt:\"[发呆]\"},{\"url\":\"197.gif\",alt:\"[背着]\"},{\"url\":\"198.gif\",alt:\"[伸手]\"},{\"url\":\"199.gif\",alt:\"[耍帅]\"},{\"url\":\"200.png\",alt:\"[微笑]\"},{\"url\":\"201.png\",alt:\"[生病]\"},{\"url\":\"202.png\",alt:\"[哭泣]\"},{\"url\":\"203.png\",alt:\"[吐舌]\"},{\"url\":\"204.png\",alt:\"[迷糊]\"},{\"url\":\"205.png\",alt:\"[瞪眼]\"},{\"url\":\"206.png\",alt:\"[恐怖]\"},{\"url\":\"207.png\",alt:\"[忧愁]\"},{\"url\":\"208.png\",alt:\"[眨眉]\"},{\"url\":\"209.png\",alt:\"[闭眼]\"},{\"url\":\"210.png\",alt:\"[鄙视]\"},{\"url\":\"211.png\",alt:\"[阴暗]\"},{\"url\":\"212.png\",alt:\"[小鬼]\"},{\"url\":\"213.png\",alt:\"[礼物]\"},{\"url\":\"214.png\",alt:\"[拜佛]\"},{\"url\":\"215.png\",alt:\"[力量]\"},{\"url\":\"216.png\",alt:\"[金钱]\"},{\"url\":\"217.png\",alt:\"[蛋糕]\"},{\"url\":\"218.png\",alt:\"[彩带]\"},{\"url\":\"219.png\",alt:\"[礼物]\"},]\t\t\t\t\r\n\t\t\t\t],\r\n\t\t\t\t\r\n\t\t\t};\r\n\t\t},\r\n\t\tonLoad(res) {\r\n\t\t\tthis.info = getApp().globalData.info;\r\n\t\t\tthis.app = getApp().globalData;\r\n\t\t\t\r\n\t\t\tthis.initTargetUserInfo(res.userId);\r\n\t\t\t\r\n\t\t\tthis.initMsgList(res.userId);\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t//语音自然播放结束\r\n\t\t\tthis.AUDIO.onEnded((res)=>{\r\n\t\t\t\tthis.playMsgid=null;\r\n\t\t\t});\r\n\t\t\t// #ifndef H5\r\n\t\t\t//录音开始事件\r\n\t\t\tthis.RECORDER.onStart((e)=>{\r\n\t\t\t\tthis.recordBegin(e);\r\n\t\t\t})\r\n\t\t\t//录音结束事件\r\n\t\t\tthis.RECORDER.onStop((e)=>{\r\n\t\t\t\tthis.recordEnd(e);\r\n\t\t\t})\r\n\t\t\t// #endif\r\n\t\t},\r\n\t\tonShow(){\r\n\t\t\tthis.scrollTop = 9999999;\r\n\t\t\t\r\n\t\t\t\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\tinitTargetUserInfo(targetUserId){\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\tmethod: 'get',\r\n\t\t\t\t\turl: this.app.url + \"/userInfo/\"+targetUserId,\r\n\t\t\t\t\theader: this.app.genHeader(this.app.token.a,this.app.token.r),\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tthis.targetUserInfo = getUserInfo(res.data.data);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (res)=>{console.log(res)},\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tnavigate(){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/root/me/me_external/me_external?userId='+this.userId,\r\n\t\t\t\t\tsuccess: res => {},\r\n\t\t\t\t\tfail: () => {},\r\n\t\t\t\t\tcomplete: () => {}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tsetHint(hint) {\r\n\t\t\t\tthis.$refs.uToast.show({\r\n\t\t\t\t\ttitle: hint,\r\n\t\t\t\t\tduration: this.durationPullDownRefresh\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 接受消息(筛选处理)\r\n\t\t\tscreenMsg(msg){\r\n\t\t\t\t//从长连接处转发给这个方法，进行筛选处理\r\n\t\t\t\tif(msg.type==1){\r\n\t\t\t\t\t// 系统消息\r\n\t\t\t\t\tswitch (msg.type){\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\tthis.addSystemTextMsg(msg);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}else if(msg.type==0){\r\n\t\t\t\t\t// 用户消息\r\n\t\t\t\t\tswitch (msg.contentType){\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\tthis.addTextMsg(msg);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tthis.addImgMsg(msg);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\tthis.addVoiceMsg(msg);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconsole.log('用户消息');\r\n\t\t\t\t\t//非自己的消息震动\r\n\t\t\t\t\tif(msg.senderUserId!=this.app.userInfo.userId){\r\n\t\t\t\t\t\tconsole.log('振动');\r\n\t\t\t\t\t\tuni.vibrateLong();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t// 滚动到底\r\n\t\t\t\t\tthis.scrollToView = 'msg'+msg.msg.id\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetHistory() {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\t// 消息列表\r\n\t\t\t\t\t\tlet list = [\r\n\t\t\t\t\t\t\t{type:0,msg:{id:1,type:0,time:\"12:56\",userinfo:{uid:0,username:\"大黑哥\",face:\"https://lets-team--public.oss-cn-hangzhou.aliyuncs.com/user/alias/alias (2).jpg\"},content:{text:\"为什么温度会相差那么大？\"}}},\r\n\t\t\t\t\t\t\t{type:0,msg:{id:2,type:0,time:\"12:57\",userinfo:{uid:1,username:\"售后客服008\",face:\"https://lets-team--public.oss-cn-hangzhou.aliyuncs.com/user/alias/alias (1).jpg\"},content:{text:\"这个是有偏差的，两个温度相差十几二十度是很正常的，如果相差五十度，那即是质量问题了。\"}}},\r\n\t\t\t\t\t\t\t{type:0,msg:{id:3,type:2,time:\"12:59\",userinfo:{uid:1,username:\"售后客服008\",face:\"https://lets-team--public.oss-cn-hangzhou.aliyuncs.com/user/alias/alias (1).jpg\"},content:{url:\"/static/voice/1.mp3\",length:\"00:06\"}}},\r\n\t\t\t\t\t\t\t{type:0,msg:{id:4,type:2,time:\"13:05\",userinfo:{uid:0,username:\"大黑哥\",face:\"https://lets-team--public.oss-cn-hangzhou.aliyuncs.com/user/alias/alias (2).jpg\"},content:{url:\"/static/voice/1.mp3\",length:\"00:06\"}}},\r\n\t\t\t\t\t\t];\r\n\t\t\t\t\t\treject(list);\r\n\t\t\t\t\t},1000);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//触发滑动到顶部(加载历史信息记录)\r\n\t\t\tasync loadHistory(e) {\r\n\t\t\t\tif(this.isHistoryLoading){\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.isHistoryLoading = true;//参数作为进入请求标识，防止重复请求\r\n\t\t\t\tthis.scrollAnimation = false;//关闭滑动动画\r\n\t\t\t\tlet Viewid = this.msgList[0].msg.id;//记住第一个信息ID\r\n\t\t\t\t//本地模拟请求历史记录效果\r\n\t\t\t\t\r\n\t\t\t\t// 消息列表\r\n\t\t\t\ttry{\r\n\t\t\t\t\tlet list = await this.getHistory();\r\n\t\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\t\tfor(let i=0;i<list.length;i++){\r\n\t\t\t\t\t\tif(list[i].type=='user'&&list[i].msg.type==\"img\"){\r\n\t\t\t\t\t\t\tlist[i].msg.content = this.setPicSize(list[i].msg.content);\r\n\t\t\t\t\t\t\tthis.msgImgList.unshift(list[i].msg.content.url);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlist[i].msg.id = Math.floor(Math.random()*1000+1);\r\n\t\t\t\t\t\tthis.msgList.unshift(list[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t} catch(err){\r\n\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t\tthis.setHint(\"没有别的消息啦\")\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t//这段代码很重要，不然每次加载历史数据都会跳到顶部\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\tthis.scrollToView = 'msg'+Viewid;//跳转上次的第一行信息位置\r\n\t\t\t\t\t},this.durationPullDownRefresh);\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.scrollToView = '';\r\n\t\t\t\t\tthis.isHistoryLoading = false;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\t// 加载初始页面消息\r\n\t\t\tinitMsgList(targetUserId){\r\n\t\t\t\t// 消息列表\r\n\t\t\t\tthis.msgList = [\r\n\t\t\t\t\t{type:1,contentType:0,content:\"欢迎进入HM-chat聊天室\"},\r\n\t\t\t\t\t{type:0,contentType:0,content:\"为什么温度会相差那么大？\",sendingTime:\"12:56\",senderUserId: 11},\r\n\t\t\t\t\t\r\n\t\t\t\t\t{type:0,contentType:0,content:\"这个是有偏差的，两个温度相差十几二十度是很正常的，如果相差五十度，那即是质量问题了。\",\r\n\t\t\t\t\tsendingTime:\"12:57\",senderUserId: 12},\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t{type:0,contentType:2,length:\"00:06\",sendingTime:\"12:59\",\r\n\t\t\t\t\tsenderUserId: 12,url:\"/static/voice/1.mp3\"},\r\n\t\t\t\t\t{type:0,contentType:2,length:\"00:08\",sendingTime:\"13:05\",\r\n\t\t\t\t\tsenderUserId: 11,url:\"/static/voice/1.mp3\"},\r\n\t\t\t\t\t\r\n\t\t\t\t\t{type:0,contentType:1,url: \"https://stea.ryanalexander.cn/navbar/11.jpg\",sendingTime:\"13:05\",senderUserId: 11,},\r\n\t\t\t\t\r\n\t\t\t\t\t{type:1,contentType:0,content:\"欢迎进入HM-chat聊天室\"},\r\n\t\t\t\t\t{type:0,contentType:0,content:\"为什么温度会相差那么大？\",sendingTime:\"12:56\",senderUserId: 11},\r\n\t\t\t\t\t\r\n\t\t\t\t\t{type:0,contentType:0,content:\"这个是有偏差的，两个温度相差十几二十度是很正常的，如果相差五十度，那即是质量问题了。\",\r\n\t\t\t\t\tsendingTime:\"12:57\",senderUserId: 12},\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t{type:0,contentType:2,length:\"00:06\",sendingTime:\"12:59\",\r\n\t\t\t\t\tsenderUserId: 12,url:\"/static/voice/1.mp3\"},\r\n\t\t\t\t\t{type:0,contentType:2,length:\"00:08\",sendingTime:\"13:05\",\r\n\t\t\t\t\tsenderUserId: 11,url:\"/static/voice/1.mp3\"},\r\n\t\t\t\t\t\r\n\t\t\t\t\t{type:0,contentType:1,url: \"https://stea.ryanalexander.cn/navbar/11.jpg\",sendingTime:\"13:05\",senderUserId: 11,},\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t];\r\n\t\t\t\tthis.scrollToLastMsg();\r\n\t\t\t\t// console.log(this.targetUserInfo.userId);\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\tmethod: 'get',\r\n\t\t\t\t\turl: this.app.url + \"/message?targetUserId=\"+targetUserId,\r\n\t\t\t\t\t\r\n\t\t\t\t\theader: this.app.genHeader(this.app.token.a,\"\"),\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tconsole.log(\"success\");\r\n\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\t\t\t\t\tfail: (res)=>{\r\n\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tscrollToLastMsg(){\r\n\t\t\t\t// TODO 每次发送到最新消息！ 另外 如何保存消息记录？？ \r\n\t\t\t\t// 可能需要全局 似乎退出页面以后啥都没了\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\tthis.scrollTop = 9999;\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//更多功能(点击+弹出) \r\n\t\t\tshowMore(){\r\n\t\t\t\tthis.isVoice = false;\r\n\t\t\t\tthis.hideEmoji = true;\r\n\t\t\t\tif(this.hideMore){\r\n\t\t\t\t\tthis.hideMore = false;\r\n\t\t\t\t\tthis.openDrawer();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 打开抽屉\r\n\t\t\topenDrawer(){\r\n\t\t\t\tthis.popupLayerClass = 'showLayer';\r\n\t\t\t},\r\n\t\t\t// 隐藏抽屉\r\n\t\t\thideDrawer(){\r\n\t\t\t\tthis.popupLayerClass = '';\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tthis.hideMore = true;\r\n\t\t\t\t\tthis.hideEmoji = true;\r\n\t\t\t\t},150);\r\n\t\t\t},\r\n\t\t\t// 选择图片发送\r\n\t\t\tchooseImage(){\r\n\t\t\t\tthis.getImage('album');\r\n\t\t\t},\r\n\t\t\t//拍照发送\r\n\t\t\tcamera(){\r\n\t\t\t\tthis.getImage('camera');\r\n\t\t\t},\r\n\t\r\n\t\t\t//选照片 or 拍照\r\n\t\t\tgetImage(type){\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tsourceType:[type],\r\n\t\t\t\t\tsizeType: ['original', 'compressed'], //可以指定是原图还是压缩图，默认二者都有\r\n\t\t\t\t\tsuccess: (res)=>{\r\n\t\t\t\t\t\tfor(let i=0;i<res.tempFilePaths.length;i++){\r\n\t\t\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\t\t\tsrc: res.tempFilePaths[i],\r\n\t\t\t\t\t\t\t\tsuccess: (image)=>{\r\n\t\t\t\t\t\t\t\t\tconsole.log(image.width);\r\n\t\t\t\t\t\t\t\t\tconsole.log(image.height);\r\n\t\t\t\t\t\t\t\t\tlet msg = {url:res.tempFilePaths[i],w:image.width,h:image.height};\r\n\t\t\t\t\t\t\t\t\tthis.sendMsg(msg,'img');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 选择表情\r\n\t\t\tchooseEmoji(){\r\n\t\t\t\tthis.hideMore = true;\r\n\t\t\t\tif(this.hideEmoji){\r\n\t\t\t\t\tthis.hideEmoji = false;\r\n\t\t\t\t\tthis.openDrawer();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//添加表情\r\n\t\t\taddEmoji(em){\r\n\t\t\t\tthis.textMsg+=em.alt;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t//获取焦点，如果不是选表情ing,则关闭抽屉\r\n\t\t\ttextareaFocus(){\r\n\t\t\t\tif(this.popupLayerClass=='showLayer' && this.hideMore == false){\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 发送文字消息\r\n\t\t\tsendText(){\r\n\t\t\t\tthis.hideDrawer();//隐藏抽屉\r\n\t\t\t\tif(!this.textMsg){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// TODO 这玩意不是应该用来显示的嘛 为啥要保存 并且push到List里面了\r\n\t\t\t\tlet content = this.replaceEmoji(this.textMsg);\r\n\t\t\t\t\r\n\t\t\t\tthis.sendMsg(this.textMsg,0);\r\n\t\t\t\tthis.textMsg = '';//清空输入框\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\t//替换表情符号为图片\r\n\t\t\treplaceEmoji(str){\r\n\t\t\t\tlet replacedStr = str.replace(/\\[([^(\\]|\\[)]*)\\]/g,(item, index)=>{\r\n\t\t\t\t\tconsole.log(\"item: \" + item);\r\n\t\t\t\t\tfor(let i=0;i<this.emojiList.length;i++){\r\n\t\t\t\t\t\tlet row = this.emojiList[i];\r\n\t\t\t\t\t\tfor(let j=0;j<row.length;j++){\r\n\t\t\t\t\t\t\tlet EM = row[j];\r\n\t\t\t\t\t\t\tif(EM.alt==item){\r\n\t\t\t\t\t\t\t\t//在线表情路径，图文混排必须使用网络路径，请上传一份表情到你的服务器后再替换此路径 \r\n\t\t\t\t\t\t\t\t//比如你上传服务器后，你的100.gif路径为https://www.xxx.com/emoji/100.gif 则替换onlinePath填写为https://www.xxx.com/emoji/\r\n\t\t\t\t\t\t\t\tlet onlinePath = 'https://stea.ryanalexander.cn/im/'\r\n\t\t\t\t\t\t\t\tlet imgstr = '<img src=\"'+onlinePath+EM.url+'\">';\r\n\t\t\t\t\t\t\t\tconsole.log(\"imgstr: \" + imgstr);\r\n\t\t\t\t\t\t\t\treturn imgstr;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn '<div style=\"display: flex;align-items: center;word-wrap:break-word;\">'+replacedStr+'</div>';\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 发送消息\r\n\t\t\tsendMsg(content,contentType){\r\n\t\t\t\tvar nowDate = new Date();\r\n\t\t\t\t\r\n\t\t\t\tlet msg = {contentType: contentType, type:0, sendTime:nowDate.getHours()+\":\"+nowDate.getMinutes(),\r\n\t\t\t\tsenderUserId: this.app.userInfo.userId, content:content}\r\n\t\t\t\t\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\tmethod: 'post',\r\n\t\t\t\t\turl: this.app.url + \"/message\",\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\"receiverUserId\": this.targetUserInfo.userId,\r\n\t\t\t\t\t\t\"contentType\": contentType,\r\n\t\t\t\t\t\t\"content\": content\r\n\t\t\t\t\t},\r\n\t\t\t\t\theader: this.app.genHeader(this.app.token.a,\"\"),\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\tthis.screenMsg(msg);\r\n\t\t\t\t\t\tthis.scrollToLastMsg();\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\t\t\t\t\tfail: (res)=>{\r\n\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t//ryan_alexander@hzbytecloud.cn\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 添加文字消息到列表\r\n\t\t\taddTextMsg(msg){\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加语音消息到列表\r\n\t\t\taddVoiceMsg(msg){\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加图片消息到列表\r\n\t\t\taddImgMsg(msg){\r\n\t\t\t\t// msg.msg.content = this.setPicSize(msg.msg.content);\r\n\t\t\t\t// this.msgImgList.push(msg.msg.content.url);\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t// 添加系统文字消息到列表\r\n\t\t\taddSystemTextMsg(msg){\r\n\t\t\t\tthis.msgList.push(msg);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tsendSystemMsg(content,type){\r\n\t\t\t\tlet lastid = this.msgList[this.msgList.length-1].msg.id;\r\n\t\t\t\tlastid++;\r\n\t\t\t\tlet row = {type:1,msg:{id:lastid,type:type,content:content}};\r\n\t\t\t\tthis.screenMsg(row)\r\n\t\t\t},\r\n\t\t\t//领取详情\r\n\t\t\ttoDetails(rid){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:'HM-details/HM-details?rid='+rid\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 预览图片\r\n\t\t\tshowPic(msg){\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tindicator:\"none\",\r\n\t\t\t\t\tcurrent:msg.content.url,\r\n\t\t\t\t\turls: this.msgImgList\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 播放语音\r\n\t\t\tplayVoice(msg){\r\n\t\t\t\tthis.playMsgid=msg.id;\r\n\t\t\t\tthis.AUDIO.src = msg.content.url;\r\n\t\t\t\tthis.$nextTick(()=> {\r\n\t\t\t\t\tthis.AUDIO.play();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 录音开始\r\n\t\t\tvoiceBegin(e){\r\n\t\t\t\tif(e.touches.length>1){\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tthis.initPoint.Y = e.touches[0].clientY;\r\n\t\t\t\tthis.initPoint.identifier = e.touches[0].identifier;\r\n\t\t\t\tthis.RECORDER.start({format:\"mp3\"});//录音开始,\r\n\t\t\t},\r\n\t\t\t//录音开始UI效果\r\n\t\t\trecordBegin(e){\r\n\t\t\t\tthis.recording = true;\r\n\t\t\t\tthis.voiceTis='松开 结束';\r\n\t\t\t\tthis.recordLength = 0;\r\n\t\t\t\tthis.recordTimer = setInterval(()=>{\r\n\t\t\t\t\tthis.recordLength++;\r\n\t\t\t\t},1000)\r\n\t\t\t},\r\n\t\t\t// 录音被打断\r\n\t\t\tvoiceCancel(){\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tthis.voiceTis='按住 说话';\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\tthis.willStop = true;//不发送录音\r\n\t\t\t\tthis.RECORDER.stop();//录音结束\r\n\t\t\t},\r\n\t\t\t// 录音中(判断是否触发上滑取消发送)\r\n\t\t\tvoiceIng(e){\r\n\t\t\t\tif(!this.recording){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet touche = e.touches[0];\r\n\t\t\t\t//上滑一个导航栏的高度触发上滑取消发送\r\n\t\t\t\tif(this.initPoint.Y - touche.clientY>=uni.upx2px(100)){\r\n\t\t\t\t\tthis.willStop = true;\r\n\t\t\t\t\tthis.recordTis = '松开手指 取消发送'\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.willStop = false;\r\n\t\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 结束录音\r\n\t\t\tvoiceEnd(e){\r\n\t\t\t\tif(!this.recording){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tthis.voiceTis='按住 说话';\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\tthis.RECORDER.stop();//录音结束\r\n\t\t\t},\r\n\t\t\t//录音结束(回调文件)\r\n\t\t\trecordEnd(e){\r\n\t\t\t\tclearInterval(this.recordTimer);\r\n\t\t\t\tif(!this.willStop){\r\n\t\t\t\t\tconsole.log(\"e: \" + JSON.stringify(e));\r\n\t\t\t\t\tlet msg = {\r\n\t\t\t\t\t\tlength:0,\r\n\t\t\t\t\t\turl:e.tempFilePath\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet min = parseInt(this.recordLength/60);\r\n\t\t\t\t\tlet sec = this.recordLength%60;\r\n\t\t\t\t\tmin = min<10?'0'+min:min;\r\n\t\t\t\t\tsec = sec<10?'0'+sec:sec;\r\n\t\t\t\t\tmsg.length = min+':'+sec;\r\n\t\t\t\t\tthis.sendMsg(msg,'voice');\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log('取消发送录音');\r\n\t\t\t\t}\r\n\t\t\t\tthis.willStop = false;\r\n\t\t\t},\r\n\t\t\t// 切换语音/文字输入\r\n\t\t\tswitchVoice(){\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t\tthis.isVoice = this.isVoice?false:true;\r\n\t\t\t},\r\n\t\t\tdiscard(){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n<style lang=\"scss\">\r\n\t@import \"@/common/uni.scss\";\r\n\t@import \"./dialog.scss\"; \r\n\t.title{\r\n\t\tcolor: $cardColor;\r\n\t\tfont-weight: bolder;\r\n\t\ttext-align: center;\r\n\t}\r\n</style>","import mod from \"-!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./dialog.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../Program Files/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./dialog.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}